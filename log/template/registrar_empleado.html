<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productos y Categorías</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
html, body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background-color: #3a3a3a;
  color: #f0f0f0;
  margin: 0;
  padding: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.navbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #2f2f2f;
  padding: 12px 30px;
  color: #fff;
  width: 100%;
}

.logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 22px;
  font-weight: bold;
  color: #ff4444;
}

.logo img {
  height: 40px;
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 25px;
  margin: 0;
  padding: 0;
}

.nav-links li a {
  color: #fff;
  text-decoration: none;
  font-weight: bold;
}

.nav-links li a:hover {
  color: #ffd700;
}

.nav-links li:not(:last-child) {
  margin-top: 5px;
}

.list-group-item {
  background-color: #4a4a4a !important;
  color: #f0f0f0 !important;
  border: 2px solid #ffd700 !important;
  margin-bottom: 8px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.25s ease;
}

#listaCategorias .list-group-item:hover,
#listaProductos .list-group-item:hover {
  background-color: #3f3f3f !important;
  border-color: #ff4444 !important;       
  transform: scale(1.03);                 
}

#listaCategorias .list-group-item.active {
  background-color: #ffd700 !important;
  color: #2f2f2f !important;
  font-weight: bold;
}

#listaProductos .list-group-item {
  border: 2px solid #ffd700 !important;
}

.estado-btn {
  padding: 3px 10px;
  border: none;
  border-radius: 5px;
  color: #fff;
  font-weight: bold;
}

.disponible { background-color: #28a745; }
.no-disponible { background-color: #dc3545; }

#listaProductos .estado-btn {
  transform: scale(1) !important;
  transition: none !important;
}

footer {
  background: #2f2f2f;
  color: #fff;
  text-align: center;
  padding: 10px;
  border-top: 2px solid #ffd700;
  margin-top: auto;
}

#alertaEstado {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2000;
  min-width: 350px;
  text-align: center;
  font-weight: bold;
  display: none;
}

  </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="logo">
    <img src="{{ url_for('static', filename='img/logooo.png') }}" alt="Logo">
    <span>Parrilla 51</span>
  </div>
  <ul class="nav-links">
    <li><a href="{{ url_for('empleado.empleado_dashboard') }}">Inicio</a></li>
    <li><a href="{{ url_for('empleado.mesas_empleado') }}">Mesas</a></li>
    <li><a href="{{ url_for('empleado.registrar_pedido') }}">Registrar</a></li>
    <li><a href="{{ url_for('empleado.ordenes_empleado') }}">Órdenes</a></li>
    <li><a href="{{ url_for('empleado.reservas_empleado') }}">Reservas</a></li>
    <li><a href="{{ url_for('empleado.perfil_empleado') }}"><i class="bi bi-person-circle" style="font-size: 1.3rem;"></i></a></li>
  </ul>
</nav>

<!-- CONTENIDO -->
<div class="container my-4">
  <div class="row">
    <!-- CATEGORÍAS -->
    <div class="col-6 border-end">
      <h4 class="text-center mb-3">Categorías</h4>
      <ul id="listaCategorias" class="list-group">
        {% for c in categorias %}
        <li class="list-group-item" data-categoria="{{ c.id_categoria }}">{{ c.nombre_categoria }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- PRODUCTOS -->
    <div class="col-6">
      <h4 class="text-center mb-3">Productos</h4>
      <ul id="listaProductos" class="list-group"></ul>
    </div>
  </div>
</div>

<!-- ALERTA -->
<div id="alertaEstado" class="alert"></div>

<footer>
  © 2025 Parrilla 51 - Todos los derechos reservados
</footer>

<!-- MODAL -->
<div class="modal fade" id="estadoModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content bg-dark text-light">
      <div class="modal-header">
        <h5 class="modal-title">Cambiar estado del producto</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <p id="productoSeleccionado"></p>
        <p>Selecciona el nuevo estado:</p>
        <button class="btn btn-success me-2" id="btnDisponible">Disponible</button>
        <button class="btn btn-danger" id="btnNoDisponible">No disponible</button>
      </div>
    </div>
  </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function formato(num) {
  return Number(num).toLocaleString('en-US', {
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  });
}
const productos = [
  {% for p in productos %}
  {
    id: {{ p.id_producto }},
    nombre: "{{ p.nombre }}",
    precio: {{ p.precio }},
    categoria: {{ p.id_categoria }},
    nombre_categoria: "{{ p.nombre_categoria }}",
    estado: "{{ p.estado or 'Disponible' }}"
  }{% if not loop.last %},{% endif %}
  {% endfor %}
];

const listaCategorias = document.getElementById('listaCategorias');
const listaProductos = document.getElementById('listaProductos');
let productoActual = null;
const modal = new bootstrap.Modal(document.getElementById('estadoModal'));
const alerta = document.getElementById('alertaEstado');

listaCategorias.addEventListener('click', (e) => {
  if (!e.target.classList.contains('list-group-item')) return;

  listaCategorias.querySelectorAll('.list-group-item').forEach(i => i.classList.remove('active'));
  e.target.classList.add('active');

  const categoriaId = parseInt(e.target.dataset.categoria);
  const filtrados = productos.filter(p => p.categoria === categoriaId);

  listaProductos.innerHTML = "";

  if (filtrados.length === 0) {
    listaProductos.innerHTML = `<li class="list-group-item">No hay productos en esta categoría.</li>`;
    return;
  }

  filtrados.forEach(p => {
    const li = document.createElement("li");
    li.className = "list-group-item";

    li.innerHTML = `
      <span>${p.nombre} - $${formato(p.precio)} [${p.nombre_categoria}]</span>
      <button class="estado-btn ${p.estado === 'Disponible' ? 'disponible' : 'no-disponible'}">
        ${p.estado}
      </button>
    `;

    li.querySelector("button").onclick = () => {
      productoActual = p;
      document.getElementById("productoSeleccionado").textContent = `Producto: ${p.nombre}`;
      modal.show();
    };

    listaProductos.appendChild(li);
  });
});

document.getElementById('btnDisponible').onclick = () => cambiarEstado('Disponible');
document.getElementById('btnNoDisponible').onclick = () => cambiarEstado('No disponible');

function cambiarEstado(nuevo) {
  if (!productoActual) return;

  fetch('/empleado/actualizar_estado_producto', {
    method: 'POST',
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      id_producto: productoActual.id,
      estado: nuevo
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      productoActual.estado = nuevo;
      mostrarAlerta("Estado actualizado correctamente", "success");
      listaCategorias.querySelector('.active').click(); // refrescar lista
    } else {
      mostrarAlerta("Error al actualizar estado", "danger");
    }
  });

  modal.hide();
}

function mostrarAlerta(msg, tipo) {
  alerta.textContent = msg;
  alerta.className = `alert alert-${tipo}`;
  alerta.style.display = "block";
  alerta.style.opacity = "1";

  setTimeout(() => {
    alerta.style.opacity = "0";
    setTimeout(() => alerta.style.display = "none", 500);
  }, 2500);
}
</script>

</body>
</html>
